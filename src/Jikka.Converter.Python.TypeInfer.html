<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Jikka.Converter.Python.TypeInfer</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#run"><span class="hs-identifier">run</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html"><span class="hs-identifier">Jikka.Language.Common.Name</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html"><span class="hs-identifier">Jikka.Language.Python.Typed.Expr</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html"><span class="hs-identifier">Jikka.Language.Python.Typed.Stdlib</span></a></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- prepare a monad</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">data</span><span> </span><span id="TypingState"><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#TypingState"><span class="hs-identifier hs-var">TypingState</span></a></span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TypingState"><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#TypingState"><span class="hs-identifier hs-var">TypingState</span></a></span></span><span>
</span><span id="line-16"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="varenv"><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Common.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span id="funenv"><span class="annot"><span class="annottext">TypingState -&gt; [(FunName, ([Type], Type))]
</span><a href="Jikka.Converter.Python.TypeInfer.html#funenv"><span class="hs-identifier hs-var hs-var">funenv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Common.Name.html#FunName"><span class="hs-identifier hs-type">FunName</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span id="subst"><span class="annot"><span class="annottext">TypingState -&gt; Map TypeName Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#subst"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-19"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">type</span><span> </span><span id="Typing"><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-var">Typing</span></a></span></span><span> </span><span id="local-6989586621679162486"><span class="annot"><a href="#local-6989586621679162486"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#TypingState"><span class="hs-identifier hs-type">TypingState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679162486"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#TypingState"><span class="hs-identifier hs-type">TypingState</span></a></span><span>
</span><span id="line-24"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: TypingState
</span><a href="Jikka.Converter.Python.TypeInfer.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="annottext">TypingState :: [(VarName, Type)]
-&gt; [(FunName, ([Type], Type))] -&gt; Map TypeName Type -&gt; TypingState
</span><a href="Jikka.Converter.Python.TypeInfer.html#TypingState"><span class="hs-identifier hs-type hs-type">TypingState</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">varenv :: [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var">varenv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>      </span><span class="annot"><span class="annottext">funenv :: [(FunName, ([Type], Type))]
</span><a href="Jikka.Converter.Python.TypeInfer.html#funenv"><span class="hs-identifier hs-var">funenv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>      </span><span class="annot"><span class="annottext">subst :: Map TypeName Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TypeName Type
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span id="local-6989586621679162493"><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#runTyping"><span class="hs-identifier hs-type">runTyping</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679162493"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679162493"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-32"></span><span id="runTyping"><span class="annot"><span class="annottext">runTyping :: Typing a -&gt; Either String a
</span><a href="Jikka.Converter.Python.TypeInfer.html#runTyping"><span class="hs-identifier hs-var hs-var">runTyping</span></a></span></span><span> </span><span id="local-6989586621679162481"><span class="annot"><span class="annottext">a :: Typing a
</span><a href="#local-6989586621679162481"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State TypingState (Either String a)
-&gt; TypingState -&gt; Either String a
forall s a. State s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Typing a -&gt; State TypingState (Either String a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">Typing a
</span><a href="#local-6989586621679162481"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="Jikka.Converter.Python.TypeInfer.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- prepare utilities</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#lookupVar"><span class="hs-identifier hs-type">lookupVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-38"></span><span id="lookupVar"><span class="annot"><span class="annottext">lookupVar :: VarName -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupVar"><span class="hs-identifier hs-var hs-var">lookupVar</span></a></span></span><span> </span><span id="local-6989586621679162477"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162477"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-39"></span><span>  </span><span id="local-6989586621679162476"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162476"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName -&gt; [(VarName, Type)] -&gt; Maybe Type
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162477"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">([(VarName, Type)] -&gt; Maybe Type)
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
-&gt; ExceptT String (State TypingState) (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; [(VarName, Type)])
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162476"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing Type
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing Type) -&gt; String -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: undefined variable: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; String
</span><a href="Jikka.Language.Common.Name.html#unVarName"><span class="hs-identifier hs-var">unVarName</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162477"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162469"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162469"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162469"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-type">insertVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span id="insertVar"><span class="annot"><span class="annottext">insertVar :: VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var hs-var">insertVar</span></a></span></span><span> </span><span id="local-6989586621679162467"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162467"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162466"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162466"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="annottext">(TypingState -&gt; TypingState) -&gt; Typing ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TypingState -&gt; TypingState) -&gt; Typing ())
-&gt; (TypingState -&gt; TypingState) -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162464"><span class="annot"><span class="annottext">state :: TypingState
</span><a href="#local-6989586621679162464"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162464"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">varenv :: [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var">varenv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162467"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162466"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VarName, Type) -&gt; [(VarName, Type)] -&gt; [(VarName, Type)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162464"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621679162511"><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-type">withNewVarEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679162511"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679162511"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-49"></span><span id="withNewVarEnv"><span class="annot"><span class="annottext">withNewVarEnv :: Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var hs-var">withNewVarEnv</span></a></span></span><span> </span><span id="local-6989586621679162462"><span class="annot"><span class="annottext">cont :: Typing a
</span><a href="#local-6989586621679162462"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>  </span><span id="local-6989586621679162461"><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162461"><span class="hs-identifier hs-var">varenv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; [(VarName, Type)])
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621679162460"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679162460"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing a
</span><a href="#local-6989586621679162462"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="annottext">(TypingState -&gt; TypingState) -&gt; Typing ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TypingState -&gt; TypingState) -&gt; Typing ())
-&gt; (TypingState -&gt; TypingState) -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162459"><span class="annot"><span class="annottext">state :: TypingState
</span><a href="#local-6989586621679162459"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162459"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">varenv :: [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var">varenv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162461"><span class="hs-identifier hs-var">varenv'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; Typing a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679162460"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span id="local-6989586621679162532"><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#withVar"><span class="hs-identifier hs-type">withVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679162532"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679162532"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-56"></span><span id="withVar"><span class="annot"><span class="annottext">withVar :: VarName -&gt; Type -&gt; Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withVar"><span class="hs-identifier hs-var hs-var">withVar</span></a></span></span><span> </span><span id="local-6989586621679162457"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162457"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162456"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162456"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162455"><span class="annot"><span class="annottext">cont :: Typing a
</span><a href="#local-6989586621679162455"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621679162454"><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162454"><span class="hs-identifier hs-var">varenv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; [(VarName, Type)])
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162457"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162456"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621679162453"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679162453"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing a
</span><a href="#local-6989586621679162455"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621679162452"><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162452"><span class="hs-identifier hs-var">varenv''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; [(VarName, Type)])
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162452"><span class="hs-identifier hs-var">varenv''</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)] -&gt; [(VarName, Type)] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162457"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162456"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(VarName, Type) -&gt; [(VarName, Type)] -&gt; [(VarName, Type)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162454"><span class="hs-identifier hs-var">varenv'</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; TypingState) -&gt; Typing ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TypingState -&gt; TypingState) -&gt; Typing ())
-&gt; (TypingState -&gt; TypingState) -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162451"><span class="annot"><span class="annottext">state :: TypingState
</span><a href="#local-6989586621679162451"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162451"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">varenv :: [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var">varenv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162454"><span class="hs-identifier hs-var">varenv'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: varenv is broken&quot;</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; Typing a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679162453"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#lookupFun"><span class="hs-identifier hs-type">lookupFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#FunName"><span class="hs-identifier hs-type">FunName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span id="lookupFun"><span class="annot"><span class="annottext">lookupFun :: FunName -&gt; Typing ([Type], Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupFun"><span class="hs-identifier hs-var hs-var">lookupFun</span></a></span></span><span> </span><span id="local-6989586621679162449"><span class="annot"><span class="annottext">name :: FunName
</span><a href="#local-6989586621679162449"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621679162448"><span class="annot"><span class="annottext">Maybe ([Type], Type)
</span><a href="#local-6989586621679162448"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunName -&gt; [(FunName, ([Type], Type))] -&gt; Maybe ([Type], Type)
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162449"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">([(FunName, ([Type], Type))] -&gt; Maybe ([Type], Type))
-&gt; ExceptT String (State TypingState) [(FunName, ([Type], Type))]
-&gt; ExceptT String (State TypingState) (Maybe ([Type], Type))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; [(FunName, ([Type], Type))])
-&gt; ExceptT String (State TypingState) [(FunName, ([Type], Type))]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(FunName, ([Type], Type))]
</span><a href="Jikka.Converter.Python.TypeInfer.html#funenv"><span class="hs-identifier hs-var hs-var">funenv</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ([Type], Type)
</span><a href="#local-6989586621679162448"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing ([Type], Type)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing ([Type], Type))
-&gt; String -&gt; Typing ([Type], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: undefined function: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunName -&gt; String
</span><a href="Jikka.Language.Common.Name.html#unFunName"><span class="hs-identifier hs-var">unFunName</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162449"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162446"><span class="annot"><span class="annottext">t :: ([Type], Type)
</span><a href="#local-6989586621679162446"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([Type], Type) -&gt; Typing ([Type], Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([Type], Type)
</span><a href="#local-6989586621679162446"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#insertFun"><span class="hs-identifier hs-type">insertFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#FunName"><span class="hs-identifier hs-type">FunName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span id="insertFun"><span class="annot"><span class="annottext">insertFun :: FunName -&gt; [Type] -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertFun"><span class="hs-identifier hs-var hs-var">insertFun</span></a></span></span><span> </span><span id="local-6989586621679162444"><span class="annot"><span class="annottext">name :: FunName
</span><a href="#local-6989586621679162444"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162443"><span class="annot"><span class="annottext">ts :: [Type]
</span><a href="#local-6989586621679162443"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621679162442"><span class="annot"><span class="annottext">ret :: Type
</span><a href="#local-6989586621679162442"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">(TypingState -&gt; TypingState) -&gt; Typing ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TypingState -&gt; TypingState) -&gt; Typing ())
-&gt; (TypingState -&gt; TypingState) -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162441"><span class="annot"><span class="annottext">state :: TypingState
</span><a href="#local-6989586621679162441"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162441"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">funenv :: [(FunName, ([Type], Type))]
</span><a href="Jikka.Converter.Python.TypeInfer.html#funenv"><span class="hs-identifier hs-var">funenv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162444"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679162443"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162442"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FunName, ([Type], Type))
-&gt; [(FunName, ([Type], Type))] -&gt; [(FunName, ([Type], Type))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(FunName, ([Type], Type))]
</span><a href="Jikka.Converter.Python.TypeInfer.html#funenv"><span class="hs-identifier hs-var hs-var">funenv</span></a></span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162441"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#lookupTyVar"><span class="hs-identifier hs-type">lookupTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="lookupTyVar"><span class="annot"><span class="annottext">lookupTyVar :: TypeName -&gt; ExceptT String (State TypingState) (Maybe Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupTyVar"><span class="hs-identifier hs-var hs-var">lookupTyVar</span></a></span></span><span> </span><span id="local-6989586621679162439"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162439"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621679162438"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162438"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Map TypeName Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162439"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TypeName Type -&gt; Maybe Type)
-&gt; ExceptT String (State TypingState) (Map TypeName Type)
-&gt; ExceptT String (State TypingState) (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; Map TypeName Type)
-&gt; ExceptT String (State TypingState) (Map TypeName Type)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; Map TypeName Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#subst"><span class="hs-identifier hs-var hs-var">subst</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162438"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; ExceptT String (State TypingState) (Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621679162435"><span class="annot"><span class="annottext">name' :: TypeName
</span><a href="#local-6989586621679162435"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; ExceptT String (State TypingState) (Maybe Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162435"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162434"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162434"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; ExceptT String (State TypingState) (Maybe Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Type -&gt; ExceptT String (State TypingState) (Maybe Type))
-&gt; Maybe Type -&gt; ExceptT String (State TypingState) (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162434"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar%27"><span class="hs-identifier hs-type">insertTyVar'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span id="insertTyVar%27"><span class="annot"><span class="annottext">insertTyVar' :: TypeName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar%27"><span class="hs-identifier hs-var hs-var">insertTyVar'</span></a></span></span><span> </span><span id="local-6989586621679162432"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162432"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162431"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162431"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="annottext">(TypingState -&gt; TypingState) -&gt; Typing ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((TypingState -&gt; TypingState) -&gt; Typing ())
-&gt; (TypingState -&gt; TypingState) -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162430"><span class="annot"><span class="annottext">state :: TypingState
</span><a href="#local-6989586621679162430"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162430"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">subst :: Map TypeName Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Type -&gt; Map TypeName Type -&gt; Map TypeName Type
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162432"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162431"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypingState -&gt; Map TypeName Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#subst"><span class="hs-identifier hs-var hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TypingState
</span><a href="#local-6989586621679162430"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar"><span class="hs-identifier hs-type">insertTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Common.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span id="insertTyVar"><span class="annot"><span class="annottext">insertTyVar :: TypeName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar"><span class="hs-identifier hs-var hs-var">insertTyVar</span></a></span></span><span> </span><span id="local-6989586621679162427"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162427"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162426"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162426"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679162425"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162425"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Map TypeName Type -&gt; Maybe Type
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162427"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TypeName Type -&gt; Maybe Type)
-&gt; ExceptT String (State TypingState) (Map TypeName Type)
-&gt; ExceptT String (State TypingState) (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; Map TypeName Type)
-&gt; ExceptT String (State TypingState) (Map TypeName Type)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; Map TypeName Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#subst"><span class="hs-identifier hs-var hs-var">subst</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162425"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621679162424"><span class="annot"><span class="annottext">name' :: TypeName
</span><a href="#local-6989586621679162424"><span class="hs-identifier hs-var">name'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar"><span class="hs-identifier hs-var">insertTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162424"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162426"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing ()) -&gt; String -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: type variable already have a value: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeName -&gt; String
</span><a href="Jikka.Language.Common.Name.html#unTypeName"><span class="hs-identifier hs-var">unTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162427"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar%27"><span class="hs-identifier hs-var">insertTyVar'</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162427"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162426"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- list type equations</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-type">assertSubtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="assertSubtype"><span class="annot"><span class="annottext">assertSubtype :: Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var hs-var">assertSubtype</span></a></span></span><span> </span><span id="local-6989586621679162421"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679162420"><span class="annot"><span class="annottext">t2 :: Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ChurchType
forall expr. CurryType expr -&gt; ChurchType
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#toChurchType"><span class="hs-identifier hs-var">toChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; ChurchType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ChurchType
forall expr. CurryType expr -&gt; ChurchType
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#toChurchType"><span class="hs-identifier hs-var">toChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Typing ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621679162418"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162418"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621679162417"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162417"><span class="hs-identifier hs-var">t2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; ExceptT String (State TypingState) (Maybe Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162418"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162417"><span class="hs-identifier hs-var">t2'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162416"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162416"><span class="hs-identifier hs-var">t2'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162416"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar"><span class="hs-identifier hs-var">insertTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162418"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-comment">-- TODO: is this okay?</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621679162415"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162415"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679162414"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162414"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; ExceptT String (State TypingState) (Maybe Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162415"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162414"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162413"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162413"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162413"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertTyVar"><span class="hs-identifier hs-var">insertTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162415"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-comment">-- TODO: is this okay?</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ChurchType
forall expr. CurryType expr -&gt; ChurchType
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#toChurchType"><span class="hs-identifier hs-var">toChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; ChurchType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ChurchType
forall expr. CurryType expr -&gt; ChurchType
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#toChurchType"><span class="hs-identifier hs-var">toChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Typing ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162411"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162411"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162410"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162410"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162411"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162410"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162408"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162408"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162407"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162407"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162408"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162407"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162406"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162406"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162404"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162404"><span class="hs-identifier hs-var">t2'</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162406"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162404"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162403"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162403"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162402"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162402"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162403"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162402"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162401"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162401"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162400"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162400"><span class="hs-identifier hs-var">t2'</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162401"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162400"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162399"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162399"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162398"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162398"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162399"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162398"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162397"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162397"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162396"><span class="annot"><span class="annottext">t2' :: Type
</span><a href="#local-6989586621679162396"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162397"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162396"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing ()) -&gt; String -&gt; Typing ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: they are not in subtype relation: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162421"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162420"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-124"></span><span id="unifyType"><span class="annot"><span class="annottext">unifyType :: Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var hs-var">unifyType</span></a></span></span><span> </span><span id="local-6989586621679162394"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162394"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162394"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-type">ATyInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-var">ATyInt</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-type">ATyBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-var">ATyBool</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162391"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162391"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Typing Type -&gt; Typing Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162391"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-type">ATyNat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInterval"><span class="hs-identifier hs-type">ATyInterval</span></a></span><span> </span><span id="local-6989586621679162388"><span class="annot"><span class="annottext">l :: Expr
</span><a href="#local-6989586621679162388"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679162387"><span class="annot"><span class="annottext">r :: Expr
</span><a href="#local-6989586621679162387"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162386"><span class="annot"><span class="annottext">l :: Expr
</span><a href="#local-6989586621679162386"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162385"><span class="annot"><span class="annottext">tl :: Type
</span><a href="#local-6989586621679162385"><span class="hs-identifier hs-var">tl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162388"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162383"><span class="annot"><span class="annottext">r :: Expr
</span><a href="#local-6989586621679162383"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162382"><span class="annot"><span class="annottext">tr :: Type
</span><a href="#local-6989586621679162382"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162387"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162385"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-var">ATyInt</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162382"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-var">ATyInt</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Typing Type) -&gt; Type -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr -&gt; Type
forall expr. expr -&gt; expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInterval"><span class="hs-identifier hs-var">ATyInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162386"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162383"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162381"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162381"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-var">ATyIterator</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Typing Type -&gt; Typing Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162381"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162380"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162380"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162379"><span class="annot"><span class="annottext">n :: Expr
</span><a href="#local-6989586621679162379"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162378"><span class="annot"><span class="annottext">n :: Expr
</span><a href="#local-6989586621679162378"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162377"><span class="annot"><span class="annottext">tn :: Type
</span><a href="#local-6989586621679162377"><span class="hs-identifier hs-var">tn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162379"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162377"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Expr -&gt; Type
forall expr. CurryType expr -&gt; expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-var">ATyArray</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Expr -&gt; Type)
-&gt; Typing Type -&gt; ExceptT String (State TypingState) (Expr -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162380"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Type)
-&gt; ExceptT String (State TypingState) Expr -&gt; Typing Type
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162378"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621679162376"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162376"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Typing Type) -&gt; Type -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Type
forall expr. TypeName -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162376"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#unifyComprehension"><span class="hs-identifier hs-type">unifyComprehension</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="unifyComprehension"><span class="annot"><span class="annottext">unifyComprehension :: Comprehension -&gt; Typing (Comprehension, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyComprehension"><span class="hs-identifier hs-var hs-var">unifyComprehension</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span> </span><span id="local-6989586621679162373"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162373"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679162372"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162372"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162371"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162371"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162370"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162370"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162369"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162369"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679162368"><span class="annot"><span class="annottext">e3 :: Maybe Expr
</span><a href="#local-6989586621679162368"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621679162367"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162367"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162373"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621679162366"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162366"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162370"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679162365"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162365"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162364"><span class="annot"><span class="annottext">t2 :: Type
</span><a href="#local-6989586621679162364"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162369"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162364"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-var">ATyIterator</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162366"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">VarName
-&gt; Type
-&gt; Typing (Comprehension, Type)
-&gt; Typing (Comprehension, Type)
forall a. VarName -&gt; Type -&gt; Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162371"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162366"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing (Comprehension, Type) -&gt; Typing (Comprehension, Type))
-&gt; Typing (Comprehension, Type) -&gt; Typing (Comprehension, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162363"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162363"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162362"><span class="annot"><span class="annottext">t1' :: Type
</span><a href="#local-6989586621679162362"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162372"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162362"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162367"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679162361"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679162361"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679162368"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Expr -&gt; ExceptT String (State TypingState) (Maybe Expr)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162360"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162360"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679162359"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162359"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162358"><span class="annot"><span class="annottext">t3 :: Type
</span><a href="#local-6989586621679162358"><span class="hs-identifier hs-var">t3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162360"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162358"><span class="hs-identifier hs-var">t3</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-var">ATyBool</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><span class="annottext">Maybe Expr -&gt; ExceptT String (State TypingState) (Maybe Expr)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Expr -&gt; ExceptT String (State TypingState) (Maybe Expr))
-&gt; Maybe Expr -&gt; ExceptT String (State TypingState) (Maybe Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162359"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">(Comprehension, Type) -&gt; Typing (Comprehension, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; Expr -&gt; VarName -&gt; Type -&gt; Expr -&gt; Maybe Expr -&gt; Comprehension
</span><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-var">Comprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162367"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162363"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162371"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162366"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162365"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679162361"><span class="hs-identifier hs-var">e3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162367"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-type">unifyExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span id="unifyExpr"><span class="annot"><span class="annottext">unifyExpr :: Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var hs-var">unifyExpr</span></a></span></span><span> </span><span id="local-6989586621679162357"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162357"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162357"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679162355"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162355"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679162354"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162354"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162355"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162355"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162354"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621679162352"><span class="annot"><span class="annottext">lit :: Literal
</span><a href="#local-6989586621679162352"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679162352"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Type
forall expr. Literal -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#literalType"><span class="hs-identifier hs-var">literalType</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679162352"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#UnOp"><span class="hs-identifier hs-type">UnOp</span></a></span><span> </span><span id="local-6989586621679162349"><span class="annot"><span class="annottext">op :: UnaryOp
</span><a href="#local-6989586621679162349"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679162348"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162348"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679162347"><span class="annot"><span class="annottext">t1' :: CurryType expr
</span><a href="#local-6989586621679162347"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162346"><span class="annot"><span class="annottext">ret :: CurryType expr
</span><a href="#local-6989586621679162346"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnaryOp -&gt; (CurryType expr, CurryType expr)
forall expr. UnaryOp -&gt; (CurryType expr, CurryType expr)
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#unaryOpType"><span class="hs-identifier hs-var">unaryOpType</span></a></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679162349"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162344"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162344"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162343"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162343"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162348"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162343"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162347"><span class="hs-identifier hs-var">t1'</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnaryOp -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679162349"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162344"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162346"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span id="local-6989586621679162341"><span class="annot"><span class="annottext">op :: BinaryOp
</span><a href="#local-6989586621679162341"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679162340"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162340"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162339"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162339"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679162338"><span class="annot"><span class="annottext">t1' :: CurryType expr
</span><a href="#local-6989586621679162338"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162337"><span class="annot"><span class="annottext">t2' :: CurryType expr
</span><a href="#local-6989586621679162337"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162336"><span class="annot"><span class="annottext">ret :: CurryType expr
</span><a href="#local-6989586621679162336"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinaryOp -&gt; (CurryType expr, CurryType expr, CurryType expr)
forall expr.
BinaryOp -&gt; (CurryType expr, CurryType expr, CurryType expr)
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#binaryOpType"><span class="hs-identifier hs-var">binaryOpType</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679162341"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162334"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162334"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162333"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162333"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162340"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162332"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162332"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162331"><span class="annot"><span class="annottext">t2 :: Type
</span><a href="#local-6989586621679162331"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162339"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162333"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162338"><span class="hs-identifier hs-var">t1'</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162331"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162337"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinaryOp -&gt; Expr -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679162341"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162334"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162332"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162336"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#TerOp"><span class="hs-identifier hs-type">TerOp</span></a></span><span> </span><span id="local-6989586621679162329"><span class="annot"><span class="annottext">op :: TernaryOp
</span><a href="#local-6989586621679162329"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679162328"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162328"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162327"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162327"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679162326"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162326"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679162325"><span class="annot"><span class="annottext">t1' :: CurryType expr
</span><a href="#local-6989586621679162325"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162324"><span class="annot"><span class="annottext">t2' :: CurryType expr
</span><a href="#local-6989586621679162324"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162323"><span class="annot"><span class="annottext">t3' :: CurryType expr
</span><a href="#local-6989586621679162323"><span class="hs-identifier hs-var">t3'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162322"><span class="annot"><span class="annottext">ret :: CurryType expr
</span><a href="#local-6989586621679162322"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TernaryOp
-&gt; (CurryType expr, CurryType expr, CurryType expr, CurryType expr)
forall expr.
TernaryOp
-&gt; (CurryType expr, CurryType expr, CurryType expr, CurryType expr)
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ternaryOpType"><span class="hs-identifier hs-var">ternaryOpType</span></a></span><span> </span><span class="annot"><span class="annottext">TernaryOp
</span><a href="#local-6989586621679162329"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162320"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162320"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162319"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162319"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162328"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162318"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162318"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162317"><span class="annot"><span class="annottext">t2 :: Type
</span><a href="#local-6989586621679162317"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162327"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162316"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162316"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162315"><span class="annot"><span class="annottext">t3 :: Type
</span><a href="#local-6989586621679162315"><span class="hs-identifier hs-var">t3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162326"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162319"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162325"><span class="hs-identifier hs-var">t1'</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162317"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162324"><span class="hs-identifier hs-var">t2'</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162315"><span class="hs-identifier hs-var">t3</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162323"><span class="hs-identifier hs-var">t3'</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TernaryOp -&gt; Expr -&gt; Expr -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#TerOp"><span class="hs-identifier hs-var">TerOp</span></a></span><span> </span><span class="annot"><span class="annottext">TernaryOp
</span><a href="#local-6989586621679162329"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162320"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162318"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162316"><span class="hs-identifier hs-var">e3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="#local-6989586621679162322"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span> </span><span id="local-6989586621679162313"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162313"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162312"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162312"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162311"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162311"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162310"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162310"><span class="hs-identifier hs-var">e1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162309"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162309"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162312"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162308"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162308"><span class="hs-identifier hs-var">e2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162307"><span class="annot"><span class="annottext">t2 :: Type
</span><a href="#local-6989586621679162307"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162311"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162309"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162313"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162307"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Expr -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Sub"><span class="hs-identifier hs-var">Sub</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162313"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162310"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162308"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162313"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ListExt"><span class="hs-identifier hs-type">ListExt</span></a></span><span> </span><span id="local-6989586621679162305"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162305"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162304"><span class="annot"><span class="annottext">es :: [Expr]
</span><a href="#local-6989586621679162304"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679162303"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162303"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162305"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679162302"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162302"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Expr]
-&gt; (Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162304"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">((Expr -&gt; ExceptT String (State TypingState) Expr)
 -&gt; ExceptT String (State TypingState) [Expr])
-&gt; (Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162300"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162300"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679162299"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162299"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162298"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162298"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162300"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162298"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162303"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162299"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Expr] -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#ListExt"><span class="hs-identifier hs-var">ListExt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162303"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162302"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162303"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ListComp"><span class="hs-identifier hs-type">ListComp</span></a></span><span> </span><span id="local-6989586621679162296"><span class="annot"><span class="annottext">comp :: Comprehension
</span><a href="#local-6989586621679162296"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162295"><span class="annot"><span class="annottext">comp :: Comprehension
</span><a href="#local-6989586621679162295"><span class="hs-identifier hs-var">comp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162294"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162294"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comprehension -&gt; Typing (Comprehension, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyComprehension"><span class="hs-identifier hs-var">unifyComprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Comprehension
</span><a href="#local-6989586621679162296"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comprehension -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span> </span><span class="annot"><span class="annottext">Comprehension
</span><a href="#local-6989586621679162295"><span class="hs-identifier hs-var">comp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162294"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#IterComp"><span class="hs-identifier hs-type">IterComp</span></a></span><span> </span><span id="local-6989586621679162292"><span class="annot"><span class="annottext">comp :: Comprehension
</span><a href="#local-6989586621679162292"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162291"><span class="annot"><span class="annottext">comp :: Comprehension
</span><a href="#local-6989586621679162291"><span class="hs-identifier hs-var">comp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162290"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162290"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Comprehension -&gt; Typing (Comprehension, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyComprehension"><span class="hs-identifier hs-var">unifyComprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Comprehension
</span><a href="#local-6989586621679162292"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Comprehension -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#IterComp"><span class="hs-identifier hs-var">IterComp</span></a></span><span> </span><span class="annot"><span class="annottext">Comprehension
</span><a href="#local-6989586621679162291"><span class="hs-identifier hs-var">comp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162290"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621679162288"><span class="annot"><span class="annottext">name :: FunName
</span><a href="#local-6989586621679162288"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162287"><span class="annot"><span class="annottext">args :: [Expr]
</span><a href="#local-6989586621679162287"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162286"><span class="annot"><span class="annottext">ts :: [Type]
</span><a href="#local-6989586621679162286"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162285"><span class="annot"><span class="annottext">ret :: Type
</span><a href="#local-6989586621679162285"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunName -&gt; Typing ([Type], Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupFun"><span class="hs-identifier hs-var">lookupFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162288"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679162286"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Expr] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162287"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; Typing ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: invalid funcall&quot;</span></span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679162283"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162283"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Expr, Type)]
-&gt; ((Expr, Type) -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Expr] -&gt; [Type] -&gt; [(Expr, Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162287"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679162286"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Expr, Type) -&gt; ExceptT String (State TypingState) Expr)
 -&gt; ExceptT String (State TypingState) [Expr])
-&gt; ((Expr, Type) -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679162282"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162282"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162281"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162281"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679162280"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162280"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162279"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162279"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162282"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162279"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162281"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-211"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162280"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">(Expr, Type) -&gt; Typing (Expr, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunName -&gt; [Expr] -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162288"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162283"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162285"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#unifySentence"><span class="hs-identifier hs-type">unifySentence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sentence"><span class="hs-identifier hs-type">Sentence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sentence"><span class="hs-identifier hs-type">Sentence</span></a></span><span>
</span><span id="line-215"></span><span id="unifySentence"><span class="annot"><span class="annottext">unifySentence :: Type -&gt; Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifySentence"><span class="hs-identifier hs-var hs-var">unifySentence</span></a></span></span><span> </span><span id="local-6989586621679162277"><span class="annot"><span class="annottext">ret :: Type
</span><a href="#local-6989586621679162277"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621679162276"><span class="annot"><span class="annottext">sentence :: Sentence
</span><a href="#local-6989586621679162276"><span class="hs-identifier hs-var">sentence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Sentence
</span><a href="#local-6989586621679162276"><span class="hs-identifier hs-var">sentence</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621679162274"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162274"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679162273"><span class="annot"><span class="annottext">body1 :: [Sentence]
</span><a href="#local-6989586621679162273"><span class="hs-identifier hs-var">body1</span></a></span></span><span> </span><span id="local-6989586621679162272"><span class="annot"><span class="annottext">body2 :: [Sentence]
</span><a href="#local-6989586621679162272"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162271"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162271"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162270"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162270"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162274"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162270"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-var">ATyBool</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621679162269"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162269"><span class="hs-identifier hs-var">body1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing [Sentence] -&gt; Typing [Sentence]
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing [Sentence] -&gt; Typing [Sentence])
-&gt; Typing [Sentence] -&gt; Typing [Sentence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifySentence"><span class="hs-identifier hs-var">unifySentence</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162277"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162273"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621679162267"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162267"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing [Sentence] -&gt; Typing [Sentence]
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing [Sentence] -&gt; Typing [Sentence])
-&gt; Typing [Sentence] -&gt; Typing [Sentence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifySentence"><span class="hs-identifier hs-var">unifySentence</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162277"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162272"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; [Sentence] -&gt; [Sentence] -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162271"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162269"><span class="hs-identifier hs-var">body1</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162267"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#For"><span class="hs-identifier hs-type">For</span></a></span><span> </span><span id="local-6989586621679162265"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162265"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162264"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162264"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162263"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162263"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679162262"><span class="annot"><span class="annottext">body :: [Sentence]
</span><a href="#local-6989586621679162262"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679162261"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162261"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162264"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162260"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162260"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162259"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162259"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162263"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162259"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-var">ATyIterator</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162261"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679162258"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162258"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing [Sentence] -&gt; Typing [Sentence]
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing [Sentence] -&gt; Typing [Sentence])
-&gt; Typing [Sentence] -&gt; Typing [Sentence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162265"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162261"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-230"></span><span>      </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifySentence"><span class="hs-identifier hs-var">unifySentence</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162277"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162262"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Expr -&gt; [Sentence] -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#For"><span class="hs-identifier hs-var">For</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162265"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162261"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162260"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162258"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Declare"><span class="hs-identifier hs-type">Declare</span></a></span><span> </span><span id="local-6989586621679162256"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162256"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162255"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162255"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162254"><span class="annot"><span class="annottext">shape :: [Expr]
</span><a href="#local-6989586621679162254"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679162253"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162253"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162255"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162256"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162253"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679162252"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162252"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Expr]
-&gt; (Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162254"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">((Expr -&gt; ExceptT String (State TypingState) Expr)
 -&gt; ExceptT String (State TypingState) [Expr])
-&gt; (Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162251"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162251"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679162250"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162250"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162249"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162249"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162251"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162249"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162250"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; [Expr] -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Declare"><span class="hs-identifier hs-var">Declare</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162256"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162253"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162252"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Assign"><span class="hs-identifier hs-type">Assign</span></a></span><span> </span><span id="local-6989586621679162247"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162247"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162246"><span class="annot"><span class="annottext">indices :: [Expr]
</span><a href="#local-6989586621679162246"><span class="hs-identifier hs-var">indices</span></a></span></span><span> </span><span id="local-6989586621679162245"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162245"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679162244"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162244"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162247"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679162243"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162243"><span class="hs-identifier hs-var">indices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Expr]
-&gt; (Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162246"><span class="hs-identifier hs-var">indices</span></a></span><span> </span><span class="annot"><span class="annottext">((Expr -&gt; ExceptT String (State TypingState) Expr)
 -&gt; ExceptT String (State TypingState) [Expr])
-&gt; (Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; ExceptT String (State TypingState) [Expr]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679162242"><span class="annot"><span class="annottext">e' :: Expr
</span><a href="#local-6989586621679162242"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679162241"><span class="annot"><span class="annottext">e' :: Expr
</span><a href="#local-6989586621679162241"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162240"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162240"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162242"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162240"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162241"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162239"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162239"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162238"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162238"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162245"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Expr -&gt; Type -&gt; Type) -&gt; Type -&gt; [Expr] -&gt; Type
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679162236"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162236"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162236"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162238"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162243"><span class="hs-identifier hs-var">indices</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162244"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; [Expr] -&gt; Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162247"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162243"><span class="hs-identifier hs-var">indices</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162239"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Define"><span class="hs-identifier hs-type">Define</span></a></span><span> </span><span id="local-6989586621679162234"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162234"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162233"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162233"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162232"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162232"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621679162231"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162231"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162233"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162234"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162231"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162230"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162230"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162229"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162229"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162232"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162229"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162231"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Define"><span class="hs-identifier hs-var">Define</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162234"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162231"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162230"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621679162227"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162227"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162226"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162226"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162225"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162225"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162227"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162225"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-var">ATyBool</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162226"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679162223"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162223"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162222"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162222"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162221"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162221"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162223"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162221"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162277"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162222"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#unifyToplevelDecl"><span class="hs-identifier hs-type">unifyToplevelDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ToplevelDecl"><span class="hs-identifier hs-type">ToplevelDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ToplevelDecl"><span class="hs-identifier hs-type">ToplevelDecl</span></a></span><span>
</span><span id="line-265"></span><span id="unifyToplevelDecl"><span class="annot"><span class="annottext">unifyToplevelDecl :: ToplevelDecl -&gt; Typing ToplevelDecl
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyToplevelDecl"><span class="hs-identifier hs-var hs-var">unifyToplevelDecl</span></a></span></span><span> </span><span id="local-6989586621679162219"><span class="annot"><span class="annottext">decl :: ToplevelDecl
</span><a href="#local-6989586621679162219"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ToplevelDecl
</span><a href="#local-6989586621679162219"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ConstDef"><span class="hs-identifier hs-type">ConstDef</span></a></span><span> </span><span id="local-6989586621679162217"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162217"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162216"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162216"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162215"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162215"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679162214"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162214"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162216"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679162213"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162213"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162212"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621679162212"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing (Expr, Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyExpr"><span class="hs-identifier hs-var">unifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162215"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#assertSubtype"><span class="hs-identifier hs-var">assertSubtype</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162212"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162214"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162217"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162214"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="annottext">ToplevelDecl -&gt; Typing ToplevelDecl
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; ToplevelDecl -&gt; Typing ToplevelDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Expr -&gt; ToplevelDecl
</span><a href="Jikka.Language.Python.Typed.Expr.html#ConstDef"><span class="hs-identifier hs-var">ConstDef</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162217"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162214"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162213"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span id="local-6989586621679162210"><span class="annot"><span class="annottext">name :: FunName
</span><a href="#local-6989586621679162210"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162209"><span class="annot"><span class="annottext">args :: [(VarName, Type)]
</span><a href="#local-6989586621679162209"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679162208"><span class="annot"><span class="annottext">ret :: Type
</span><a href="#local-6989586621679162208"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621679162207"><span class="annot"><span class="annottext">body :: [Sentence]
</span><a href="#local-6989586621679162207"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Typing ToplevelDecl -&gt; Typing ToplevelDecl
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; Typing ToplevelDecl -&gt; Typing ToplevelDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621679162206"><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162206"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
-&gt; ((VarName, Type)
    -&gt; ExceptT String (State TypingState) (VarName, Type))
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162209"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(((VarName, Type)
  -&gt; ExceptT String (State TypingState) (VarName, Type))
 -&gt; ExceptT String (State TypingState) [(VarName, Type)])
-&gt; ((VarName, Type)
    -&gt; ExceptT String (State TypingState) (VarName, Type))
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679162205"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162205"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162204"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162204"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621679162203"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162203"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162204"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162205"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162203"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">(VarName, Type)
-&gt; ExceptT String (State TypingState) (VarName, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162205"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162203"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>      </span><span id="local-6989586621679162202"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162202"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162208"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">FunName -&gt; [Type] -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertFun"><span class="hs-identifier hs-var">insertFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162210"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((VarName, Type) -&gt; Type) -&gt; [(VarName, Type)] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(VarName, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162206"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162202"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span id="local-6989586621679162201"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162201"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifySentence"><span class="hs-identifier hs-var">unifySentence</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162202"><span class="hs-identifier hs-var">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162207"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">ToplevelDecl -&gt; Typing ToplevelDecl
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; ToplevelDecl -&gt; Typing ToplevelDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunName -&gt; [(VarName, Type)] -&gt; Type -&gt; [Sentence] -&gt; ToplevelDecl
</span><a href="Jikka.Language.Python.Typed.Expr.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162210"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162206"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162202"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162201"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- solve type equations</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-type">substType'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-287"></span><span id="substType%27"><span class="annot"><span class="annottext">substType' :: Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-var hs-var">substType'</span></a></span></span><span> </span><span id="local-6989586621679162199"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162199"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162199"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-type">ATyInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-var">ATyInt</span></a></span><span>
</span><span id="line-289"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-type">ATyBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-var">ATyBool</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162198"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162198"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Typing Type -&gt; Typing Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-var">substType'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162198"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-type">ATyNat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInterval"><span class="hs-identifier hs-type">ATyInterval</span></a></span><span> </span><span id="local-6989586621679162197"><span class="annot"><span class="annottext">l :: Expr
</span><a href="#local-6989586621679162197"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679162196"><span class="annot"><span class="annottext">r :: Expr
</span><a href="#local-6989586621679162196"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr -&gt; Type
forall expr. expr -&gt; expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInterval"><span class="hs-identifier hs-var">ATyInterval</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Expr -&gt; Type)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) (Expr -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162197"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Type)
-&gt; ExceptT String (State TypingState) Expr -&gt; Typing Type
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162196"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162194"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162194"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-var">ATyIterator</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Typing Type -&gt; Typing Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-var">substType'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162194"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162193"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162193"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162192"><span class="annot"><span class="annottext">n :: Expr
</span><a href="#local-6989586621679162192"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Expr -&gt; Type
forall expr. CurryType expr -&gt; expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-var">ATyArray</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Expr -&gt; Type)
-&gt; Typing Type -&gt; ExceptT String (State TypingState) (Expr -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-var">substType'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162193"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Type)
-&gt; ExceptT String (State TypingState) Expr -&gt; Typing Type
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162192"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621679162191"><span class="annot"><span class="annottext">name :: TypeName
</span><a href="#local-6989586621679162191"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621679162190"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162190"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; ExceptT String (State TypingState) (Maybe Type)
</span><a href="Jikka.Converter.Python.TypeInfer.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162191"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162190"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-298"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing Type
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing Type) -&gt; String -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Type Error: failed to guess type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeName -&gt; String
</span><a href="Jikka.Language.Common.Name.html#unTypeName"><span class="hs-identifier hs-var">unTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162191"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing Type
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing Type) -&gt; String -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Type Error: failed to guess type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeName -&gt; String
</span><a href="Jikka.Language.Common.Name.html#unTypeName"><span class="hs-identifier hs-var">unTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="#local-6989586621679162191"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162189"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162189"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-var">substType'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162189"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-type">substType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-303"></span><span id="substType"><span class="annot"><span class="annottext">substType :: Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var hs-var">substType</span></a></span></span><span> </span><span id="local-6989586621679162187"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162187"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#stripLeakedVars"><span class="hs-identifier hs-var">stripLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Typing Type) -&gt; Typing Type -&gt; Typing Type
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType%27"><span class="hs-identifier hs-var">substType'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162187"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-type">substChurchType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ChurchType"><span class="hs-identifier hs-type">ChurchType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ChurchType"><span class="hs-identifier hs-type">ChurchType</span></a></span><span>
</span><span id="line-306"></span><span id="substChurchType"><span class="annot"><span class="annottext">substChurchType :: ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var hs-var">substChurchType</span></a></span></span><span> </span><span id="local-6989586621679162183"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162183"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ChurchType
forall expr. CurryType expr -&gt; ChurchType
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#toChurchType"><span class="hs-identifier hs-var">toChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ChurchType) -&gt; Typing Type -&gt; Typing ChurchType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChurchType -&gt; Type
forall expr. ChurchType -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#toCurryType"><span class="hs-identifier hs-var">toCurryType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162183"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substUnaryOp"><span class="hs-identifier hs-type">substUnaryOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#UnaryOp"><span class="hs-identifier hs-type">UnaryOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#UnaryOp"><span class="hs-identifier hs-type">UnaryOp</span></a></span><span>
</span><span id="line-309"></span><span id="substUnaryOp"><span class="annot"><span class="annottext">substUnaryOp :: UnaryOp -&gt; Typing UnaryOp
</span><a href="Jikka.Converter.Python.TypeInfer.html#substUnaryOp"><span class="hs-identifier hs-var hs-var">substUnaryOp</span></a></span></span><span> </span><span id="local-6989586621679162180"><span class="annot"><span class="annottext">op :: UnaryOp
</span><a href="#local-6989586621679162180"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679162180"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#Len"><span class="hs-identifier hs-type">Len</span></a></span><span> </span><span id="local-6989586621679162178"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162178"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; UnaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#Len"><span class="hs-identifier hs-var">Len</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; UnaryOp) -&gt; Typing ChurchType -&gt; Typing UnaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162178"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#Sorted"><span class="hs-identifier hs-type">Sorted</span></a></span><span> </span><span id="local-6989586621679162176"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162176"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; UnaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#Sorted"><span class="hs-identifier hs-var">Sorted</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; UnaryOp) -&gt; Typing ChurchType -&gt; Typing UnaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162176"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span id="local-6989586621679162174"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162174"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; UnaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#List"><span class="hs-identifier hs-var">List</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; UnaryOp) -&gt; Typing ChurchType -&gt; Typing UnaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162174"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#Reversed"><span class="hs-identifier hs-type">Reversed</span></a></span><span> </span><span id="local-6989586621679162172"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162172"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; UnaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#Reversed"><span class="hs-identifier hs-var">Reversed</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; UnaryOp) -&gt; Typing ChurchType -&gt; Typing UnaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162172"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnaryOp -&gt; Typing UnaryOp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679162180"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substBinaryOp"><span class="hs-identifier hs-type">substBinaryOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#BinaryOp"><span class="hs-identifier hs-type">BinaryOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#BinaryOp"><span class="hs-identifier hs-type">BinaryOp</span></a></span><span>
</span><span id="line-317"></span><span id="substBinaryOp"><span class="annot"><span class="annottext">substBinaryOp :: BinaryOp -&gt; Typing BinaryOp
</span><a href="Jikka.Converter.Python.TypeInfer.html#substBinaryOp"><span class="hs-identifier hs-var hs-var">substBinaryOp</span></a></span></span><span> </span><span id="local-6989586621679162170"><span class="annot"><span class="annottext">op :: BinaryOp
</span><a href="#local-6989586621679162170"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679162170"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#Equal"><span class="hs-identifier hs-type">Equal</span></a></span><span> </span><span id="local-6989586621679162168"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162168"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; BinaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#Equal"><span class="hs-identifier hs-var">Equal</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; BinaryOp) -&gt; Typing ChurchType -&gt; Typing BinaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162168"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#NotEqual"><span class="hs-identifier hs-type">NotEqual</span></a></span><span> </span><span id="local-6989586621679162166"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162166"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; BinaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#NotEqual"><span class="hs-identifier hs-var">NotEqual</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; BinaryOp) -&gt; Typing ChurchType -&gt; Typing BinaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162166"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BinaryOp -&gt; Typing BinaryOp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679162170"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substTernaryOp"><span class="hs-identifier hs-type">substTernaryOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#TernaryOp"><span class="hs-identifier hs-type">TernaryOp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#TernaryOp"><span class="hs-identifier hs-type">TernaryOp</span></a></span><span>
</span><span id="line-323"></span><span id="substTernaryOp"><span class="annot"><span class="annottext">substTernaryOp :: TernaryOp -&gt; Typing TernaryOp
</span><a href="Jikka.Converter.Python.TypeInfer.html#substTernaryOp"><span class="hs-identifier hs-var hs-var">substTernaryOp</span></a></span></span><span> </span><span id="local-6989586621679162164"><span class="annot"><span class="annottext">op :: TernaryOp
</span><a href="#local-6989586621679162164"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TernaryOp
</span><a href="#local-6989586621679162164"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#Cond"><span class="hs-identifier hs-type">Cond</span></a></span><span> </span><span id="local-6989586621679162162"><span class="annot"><span class="annottext">t :: ChurchType
</span><a href="#local-6989586621679162162"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; TernaryOp
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#Cond"><span class="hs-identifier hs-var">Cond</span></a></span><span> </span><span class="annot"><span class="annottext">(ChurchType -&gt; TernaryOp) -&gt; Typing ChurchType -&gt; Typing TernaryOp
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ChurchType -&gt; Typing ChurchType
</span><a href="Jikka.Converter.Python.TypeInfer.html#substChurchType"><span class="hs-identifier hs-var">substChurchType</span></a></span><span> </span><span class="annot"><span class="annottext">ChurchType
</span><a href="#local-6989586621679162162"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TernaryOp -&gt; Typing TernaryOp
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TernaryOp
</span><a href="#local-6989586621679162164"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substComprehension"><span class="hs-identifier hs-type">substComprehension</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span>
</span><span id="line-328"></span><span id="substComprehension"><span class="annot"><span class="annottext">substComprehension :: Comprehension -&gt; Typing Comprehension
</span><a href="Jikka.Converter.Python.TypeInfer.html#substComprehension"><span class="hs-identifier hs-var hs-var">substComprehension</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-type">Comprehension</span></a></span><span> </span><span id="local-6989586621679162160"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679162160"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679162159"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162159"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162158"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162158"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162157"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162157"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162156"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162156"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679162155"><span class="annot"><span class="annottext">e3 :: Maybe Expr
</span><a href="#local-6989586621679162155"><span class="hs-identifier hs-var">e3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621679162154"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162154"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162160"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span id="local-6989586621679162153"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162153"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162157"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621679162152"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162152"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162156"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing Comprehension -&gt; Typing Comprehension
forall a. VarName -&gt; Type -&gt; Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162158"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162153"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing Comprehension -&gt; Typing Comprehension)
-&gt; Typing Comprehension -&gt; Typing Comprehension
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>    </span><span id="local-6989586621679162151"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162151"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162159"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621679162150"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679162150"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679162155"><span class="hs-identifier hs-var">e3</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Expr -&gt; ExceptT String (State TypingState) (Maybe Expr)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-336"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679162149"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162149"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Maybe Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) (Maybe Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162149"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><span class="annottext">Comprehension -&gt; Typing Comprehension
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Comprehension -&gt; Typing Comprehension)
-&gt; Comprehension -&gt; Typing Comprehension
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Expr -&gt; VarName -&gt; Type -&gt; Expr -&gt; Maybe Expr -&gt; Comprehension
</span><a href="Jikka.Language.Python.Typed.Expr.html#Comprehension"><span class="hs-identifier hs-var">Comprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162154"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162151"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162158"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162153"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162152"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621679162150"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-type">substExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span>
</span><span id="line-340"></span><span id="substExpr"><span class="annot"><span class="annottext">substExpr :: Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var hs-var">substExpr</span></a></span></span><span> </span><span id="local-6989586621679162148"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162148"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162148"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679162147"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162147"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; Expr -&gt; ExceptT String (State TypingState) Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162147"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621679162146"><span class="annot"><span class="annottext">lit :: Literal
</span><a href="#local-6989586621679162146"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; Expr -&gt; ExceptT String (State TypingState) Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621679162146"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#UnOp"><span class="hs-identifier hs-type">UnOp</span></a></span><span> </span><span id="local-6989586621679162145"><span class="annot"><span class="annottext">op :: UnaryOp
</span><a href="#local-6989586621679162145"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679162144"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162144"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnaryOp -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#UnOp"><span class="hs-identifier hs-var">UnOp</span></a></span><span> </span><span class="annot"><span class="annottext">(UnaryOp -&gt; Expr -&gt; Expr)
-&gt; Typing UnaryOp
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnaryOp -&gt; Typing UnaryOp
</span><a href="Jikka.Converter.Python.TypeInfer.html#substUnaryOp"><span class="hs-identifier hs-var">substUnaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">UnaryOp
</span><a href="#local-6989586621679162145"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162144"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span id="local-6989586621679162143"><span class="annot"><span class="annottext">op :: BinaryOp
</span><a href="#local-6989586621679162143"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679162142"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162142"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162141"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162141"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BinaryOp -&gt; Expr -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#BinOp"><span class="hs-identifier hs-var">BinOp</span></a></span><span> </span><span class="annot"><span class="annottext">(BinaryOp -&gt; Expr -&gt; Expr -&gt; Expr)
-&gt; Typing BinaryOp
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">BinaryOp -&gt; Typing BinaryOp
</span><a href="Jikka.Converter.Python.TypeInfer.html#substBinaryOp"><span class="hs-identifier hs-var">substBinaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">BinaryOp
</span><a href="#local-6989586621679162143"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162142"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162141"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#TerOp"><span class="hs-identifier hs-type">TerOp</span></a></span><span> </span><span id="local-6989586621679162140"><span class="annot"><span class="annottext">op :: TernaryOp
</span><a href="#local-6989586621679162140"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679162139"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162139"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162138"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162138"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679162137"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162137"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TernaryOp -&gt; Expr -&gt; Expr -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#TerOp"><span class="hs-identifier hs-var">TerOp</span></a></span><span> </span><span class="annot"><span class="annottext">(TernaryOp -&gt; Expr -&gt; Expr -&gt; Expr -&gt; Expr)
-&gt; Typing TernaryOp
-&gt; ExceptT
     String (State TypingState) (Expr -&gt; Expr -&gt; Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TernaryOp -&gt; Typing TernaryOp
</span><a href="Jikka.Converter.Python.TypeInfer.html#substTernaryOp"><span class="hs-identifier hs-var">substTernaryOp</span></a></span><span> </span><span class="annot"><span class="annottext">TernaryOp
</span><a href="#local-6989586621679162140"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162139"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162138"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162137"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span> </span><span id="local-6989586621679162136"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162136"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162135"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162135"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162134"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162134"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Expr -&gt; Expr -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Sub"><span class="hs-identifier hs-var">Sub</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Expr -&gt; Expr -&gt; Expr)
-&gt; Typing Type
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162136"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) (Expr -&gt; Expr)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162135"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Expr)
-&gt; ExceptT String (State TypingState) Expr
-&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162134"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ListExt"><span class="hs-identifier hs-type">ListExt</span></a></span><span> </span><span id="local-6989586621679162133"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162133"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162132"><span class="annot"><span class="annottext">es :: [Expr]
</span><a href="#local-6989586621679162132"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Expr] -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#ListExt"><span class="hs-identifier hs-var">ListExt</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; [Expr] -&gt; Expr)
-&gt; Typing Type
-&gt; ExceptT String (State TypingState) ([Expr] -&gt; Expr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162133"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) ([Expr] -&gt; Expr)
-&gt; ExceptT String (State TypingState) [Expr]
-&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; [Expr] -&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162132"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ListComp"><span class="hs-identifier hs-type">ListComp</span></a></span><span> </span><span id="local-6989586621679162131"><span class="annot"><span class="annottext">comp :: Comprehension
</span><a href="#local-6989586621679162131"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comprehension -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span> </span><span class="annot"><span class="annottext">(Comprehension -&gt; Expr)
-&gt; Typing Comprehension -&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Comprehension -&gt; Typing Comprehension
</span><a href="Jikka.Converter.Python.TypeInfer.html#substComprehension"><span class="hs-identifier hs-var">substComprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Comprehension
</span><a href="#local-6989586621679162131"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#IterComp"><span class="hs-identifier hs-type">IterComp</span></a></span><span> </span><span id="local-6989586621679162130"><span class="annot"><span class="annottext">comp :: Comprehension
</span><a href="#local-6989586621679162130"><span class="hs-identifier hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Comprehension -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#IterComp"><span class="hs-identifier hs-var">IterComp</span></a></span><span> </span><span class="annot"><span class="annottext">(Comprehension -&gt; Expr)
-&gt; Typing Comprehension -&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Comprehension -&gt; Typing Comprehension
</span><a href="Jikka.Converter.Python.TypeInfer.html#substComprehension"><span class="hs-identifier hs-var">substComprehension</span></a></span><span> </span><span class="annot"><span class="annottext">Comprehension
</span><a href="#local-6989586621679162130"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621679162129"><span class="annot"><span class="annottext">name :: FunName
</span><a href="#local-6989586621679162129"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162128"><span class="annot"><span class="annottext">args :: [Expr]
</span><a href="#local-6989586621679162128"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunName -&gt; [Expr] -&gt; Expr
</span><a href="Jikka.Language.Python.Typed.Expr.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162129"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr] -&gt; Expr)
-&gt; ExceptT String (State TypingState) [Expr]
-&gt; ExceptT String (State TypingState) Expr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; [Expr] -&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162128"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substSentence"><span class="hs-identifier hs-type">substSentence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sentence"><span class="hs-identifier hs-type">Sentence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sentence"><span class="hs-identifier hs-type">Sentence</span></a></span><span>
</span><span id="line-353"></span><span id="substSentence"><span class="annot"><span class="annottext">substSentence :: Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#substSentence"><span class="hs-identifier hs-var hs-var">substSentence</span></a></span></span><span> </span><span id="local-6989586621679162126"><span class="annot"><span class="annottext">sentence :: Sentence
</span><a href="#local-6989586621679162126"><span class="hs-identifier hs-var">sentence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Sentence
</span><a href="#local-6989586621679162126"><span class="hs-identifier hs-var">sentence</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621679162125"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162125"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679162124"><span class="annot"><span class="annottext">body1 :: [Sentence]
</span><a href="#local-6989586621679162124"><span class="hs-identifier hs-var">body1</span></a></span></span><span> </span><span id="local-6989586621679162123"><span class="annot"><span class="annottext">body2 :: [Sentence]
</span><a href="#local-6989586621679162123"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621679162122"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162122"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162125"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679162121"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162121"><span class="hs-identifier hs-var">body1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing [Sentence] -&gt; Typing [Sentence]
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing [Sentence] -&gt; Typing [Sentence])
-&gt; Typing [Sentence] -&gt; Typing [Sentence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#substSentence"><span class="hs-identifier hs-var">substSentence</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162124"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679162120"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162120"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing [Sentence] -&gt; Typing [Sentence]
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing [Sentence] -&gt; Typing [Sentence])
-&gt; Typing [Sentence] -&gt; Typing [Sentence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>      </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#substSentence"><span class="hs-identifier hs-var">substSentence</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162123"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; [Sentence] -&gt; [Sentence] -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#If"><span class="hs-identifier hs-var">If</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162122"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162121"><span class="hs-identifier hs-var">body1</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162120"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#For"><span class="hs-identifier hs-type">For</span></a></span><span> </span><span id="local-6989586621679162119"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162119"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162118"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162118"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162117"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162117"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679162116"><span class="annot"><span class="annottext">body :: [Sentence]
</span><a href="#local-6989586621679162116"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621679162115"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162115"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162118"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679162114"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162114"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162117"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621679162113"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162113"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Typing [Sentence] -&gt; Typing [Sentence]
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing [Sentence] -&gt; Typing [Sentence])
-&gt; Typing [Sentence] -&gt; Typing [Sentence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162119"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162115"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#substSentence"><span class="hs-identifier hs-var">substSentence</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162116"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Expr -&gt; [Sentence] -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#For"><span class="hs-identifier hs-var">For</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162119"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162115"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162114"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162113"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Declare"><span class="hs-identifier hs-type">Declare</span></a></span><span> </span><span id="local-6989586621679162112"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162112"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162111"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162111"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162110"><span class="annot"><span class="annottext">shape :: [Expr]
</span><a href="#local-6989586621679162110"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621679162109"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162109"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162111"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621679162108"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162108"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; [Expr] -&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162110"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162112"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162109"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; [Expr] -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Declare"><span class="hs-identifier hs-var">Declare</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162112"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162109"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162108"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Assign"><span class="hs-identifier hs-type">Assign</span></a></span><span> </span><span id="local-6989586621679162107"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162107"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162106"><span class="annot"><span class="annottext">indices :: [Expr]
</span><a href="#local-6989586621679162106"><span class="hs-identifier hs-var">indices</span></a></span></span><span> </span><span id="local-6989586621679162105"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162105"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VarName -&gt; [Expr] -&gt; Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Assign"><span class="hs-identifier hs-var">Assign</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162107"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">([Expr] -&gt; Expr -&gt; Sentence)
-&gt; ExceptT String (State TypingState) [Expr]
-&gt; ExceptT String (State TypingState) (Expr -&gt; Sentence)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; ExceptT String (State TypingState) Expr)
-&gt; [Expr] -&gt; ExceptT String (State TypingState) [Expr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621679162106"><span class="hs-identifier hs-var">indices</span></a></span><span> </span><span class="annot"><span class="annottext">ExceptT String (State TypingState) (Expr -&gt; Sentence)
-&gt; ExceptT String (State TypingState) Expr -&gt; Typing Sentence
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162105"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Define"><span class="hs-identifier hs-type">Define</span></a></span><span> </span><span id="local-6989586621679162104"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162104"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162103"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162103"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162102"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162102"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-375"></span><span>    </span><span id="local-6989586621679162101"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162101"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162103"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679162100"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162100"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162102"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162104"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162101"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; Sentence -&gt; Typing Sentence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Define"><span class="hs-identifier hs-var">Define</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162104"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162101"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162100"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span id="local-6989586621679162099"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162099"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Sentence)
-&gt; ExceptT String (State TypingState) Expr -&gt; Typing Sentence
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162099"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679162098"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162098"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Sentence
</span><a href="Jikka.Language.Python.Typed.Expr.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Sentence)
-&gt; ExceptT String (State TypingState) Expr -&gt; Typing Sentence
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162098"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#substToplevelDecl"><span class="hs-identifier hs-type">substToplevelDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ToplevelDecl"><span class="hs-identifier hs-type">ToplevelDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ToplevelDecl"><span class="hs-identifier hs-type">ToplevelDecl</span></a></span><span>
</span><span id="line-383"></span><span id="substToplevelDecl"><span class="annot"><span class="annottext">substToplevelDecl :: ToplevelDecl -&gt; Typing ToplevelDecl
</span><a href="Jikka.Converter.Python.TypeInfer.html#substToplevelDecl"><span class="hs-identifier hs-var hs-var">substToplevelDecl</span></a></span></span><span> </span><span id="local-6989586621679162096"><span class="annot"><span class="annottext">decl :: ToplevelDecl
</span><a href="#local-6989586621679162096"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ToplevelDecl
</span><a href="#local-6989586621679162096"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ConstDef"><span class="hs-identifier hs-type">ConstDef</span></a></span><span> </span><span id="local-6989586621679162095"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162095"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162094"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162094"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162093"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162093"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>    </span><span id="local-6989586621679162092"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162092"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162094"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-386"></span><span>    </span><span id="local-6989586621679162091"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162091"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; ExceptT String (State TypingState) Expr
</span><a href="Jikka.Converter.Python.TypeInfer.html#substExpr"><span class="hs-identifier hs-var">substExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162093"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">ToplevelDecl -&gt; Typing ToplevelDecl
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; ToplevelDecl -&gt; Typing ToplevelDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Expr -&gt; ToplevelDecl
</span><a href="Jikka.Language.Python.Typed.Expr.html#ConstDef"><span class="hs-identifier hs-var">ConstDef</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162095"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162092"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162091"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a></span><span> </span><span id="local-6989586621679162090"><span class="annot"><span class="annottext">name :: FunName
</span><a href="#local-6989586621679162090"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679162089"><span class="annot"><span class="annottext">args :: [(VarName, Type)]
</span><a href="#local-6989586621679162089"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621679162088"><span class="annot"><span class="annottext">ret :: Type
</span><a href="#local-6989586621679162088"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621679162087"><span class="annot"><span class="annottext">body :: [Sentence]
</span><a href="#local-6989586621679162087"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>    </span><span class="annot"><span class="annottext">Typing ToplevelDecl -&gt; Typing ToplevelDecl
forall a. Typing a -&gt; Typing a
</span><a href="Jikka.Converter.Python.TypeInfer.html#withNewVarEnv"><span class="hs-identifier hs-var">withNewVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; Typing ToplevelDecl -&gt; Typing ToplevelDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-390"></span><span>      </span><span id="local-6989586621679162086"><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162086"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
-&gt; ((VarName, Type)
    -&gt; ExceptT String (State TypingState) (VarName, Type))
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162089"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(((VarName, Type)
  -&gt; ExceptT String (State TypingState) (VarName, Type))
 -&gt; ExceptT String (State TypingState) [(VarName, Type)])
-&gt; ((VarName, Type)
    -&gt; ExceptT String (State TypingState) (VarName, Type))
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679162085"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162085"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679162084"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162084"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>        </span><span id="local-6989586621679162083"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162083"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162084"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">VarName -&gt; Type -&gt; Typing ()
</span><a href="Jikka.Converter.Python.TypeInfer.html#insertVar"><span class="hs-identifier hs-var">insertVar</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162085"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162083"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><span class="annottext">(VarName, Type)
-&gt; ExceptT String (State TypingState) (VarName, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162085"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162083"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>      </span><span id="local-6989586621679162082"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162082"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#substType"><span class="hs-identifier hs-var">substType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162088"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-395"></span><span>      </span><span id="local-6989586621679162081"><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162081"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Sentence -&gt; Typing Sentence) -&gt; [Sentence] -&gt; Typing [Sentence]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Sentence -&gt; Typing Sentence
</span><a href="Jikka.Converter.Python.TypeInfer.html#substSentence"><span class="hs-identifier hs-var">substSentence</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162087"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-396"></span><span>      </span><span class="annot"><span class="annottext">ToplevelDecl -&gt; Typing ToplevelDecl
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; ToplevelDecl -&gt; Typing ToplevelDecl
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunName -&gt; [(VarName, Type)] -&gt; Type -&gt; [Sentence] -&gt; ToplevelDecl
</span><a href="Jikka.Language.Python.Typed.Expr.html#FunDef"><span class="hs-identifier hs-var">FunDef</span></a></span><span> </span><span class="annot"><span class="annottext">FunName
</span><a href="#local-6989586621679162090"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[(VarName, Type)]
</span><a href="#local-6989586621679162086"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162082"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">[Sentence]
</span><a href="#local-6989586621679162081"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- stripping leaked variables</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#stripLeakedVars"><span class="hs-identifier hs-type">stripLeakedVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-402"></span><span id="stripLeakedVars"><span class="annot"><span class="annottext">stripLeakedVars :: Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#stripLeakedVars"><span class="hs-identifier hs-var hs-var">stripLeakedVars</span></a></span></span><span> </span><span id="local-6989586621679162080"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162080"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162080"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-403"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-type">ATyInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInt"><span class="hs-identifier hs-var">ATyInt</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-type">ATyBool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyBool"><span class="hs-identifier hs-var">ATyBool</span></a></span><span>
</span><span id="line-405"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-type">ATyList</span></a></span><span> </span><span id="local-6989586621679162079"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162079"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Typing Type -&gt; Typing Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#stripLeakedVars"><span class="hs-identifier hs-var">stripLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162079"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-type">ATyNat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInterval"><span class="hs-identifier hs-type">ATyInterval</span></a></span><span> </span><span id="local-6989586621679162078"><span class="annot"><span class="annottext">l :: Expr
</span><a href="#local-6989586621679162078"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679162077"><span class="annot"><span class="annottext">r :: Expr
</span><a href="#local-6989586621679162077"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621679162076"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162076"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162078"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span id="local-6989586621679162074"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162074"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162077"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Typing Type) -&gt; Type -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-411"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162076"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162074"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type
forall expr. CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyNat"><span class="hs-identifier hs-var">ATyNat</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Expr -&gt; Type
forall expr. expr -&gt; expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyInterval"><span class="hs-identifier hs-var">ATyInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162078"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162077"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-type">ATyIterator</span></a></span><span> </span><span id="local-6989586621679162072"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162072"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyIterator"><span class="hs-identifier hs-var">ATyIterator</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Typing Type -&gt; Typing Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#stripLeakedVars"><span class="hs-identifier hs-var">stripLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162072"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-type">ATyArray</span></a></span><span> </span><span id="local-6989586621679162071"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621679162071"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679162070"><span class="annot"><span class="annottext">n :: Expr
</span><a href="#local-6989586621679162070"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621679162069"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162069"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162070"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621679162068"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162068"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
</span><a href="Jikka.Converter.Python.TypeInfer.html#stripLeakedVars"><span class="hs-identifier hs-var">stripLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162071"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; Typing Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Typing Type) -&gt; Type -&gt; Typing Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162069"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
forall expr. CurryType expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyList"><span class="hs-identifier hs-var">ATyList</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162068"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Expr -&gt; Type
forall expr. CurryType expr -&gt; expr -&gt; CurryType expr
</span><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyArray"><span class="hs-identifier hs-var">ATyArray</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679162068"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162070"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Stdlib.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Typing Type
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal Error: it's already type error&quot;</span></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-type">hasLeakedVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#Typing"><span class="hs-identifier hs-type">Typing</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-422"></span><span id="hasLeakedVars"><span class="annot"><span class="annottext">hasLeakedVars :: Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var hs-var">hasLeakedVars</span></a></span></span><span> </span><span id="local-6989586621679162067"><span class="annot"><span class="annottext">e :: Expr
</span><a href="#local-6989586621679162067"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162067"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-423"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679162066"><span class="annot"><span class="annottext">name :: VarName
</span><a href="#local-6989586621679162066"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>    </span><span id="local-6989586621679162065"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162065"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarName -&gt; [(VarName, Type)] -&gt; Maybe Type
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="#local-6989586621679162066"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">([(VarName, Type)] -&gt; Maybe Type)
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
-&gt; ExceptT String (State TypingState) (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TypingState -&gt; [(VarName, Type)])
-&gt; ExceptT String (State TypingState) [(VarName, Type)]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">TypingState -&gt; [(VarName, Type)]
</span><a href="Jikka.Converter.Python.TypeInfer.html#varenv"><span class="hs-identifier hs-var hs-var">varenv</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Typing Bool) -&gt; Bool -&gt; Typing Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679162065"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#UnOp"><span class="hs-identifier hs-type">UnOp</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679162064"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162064"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162064"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#BinOp"><span class="hs-identifier hs-type">BinOp</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679162063"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162063"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162062"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162062"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679162061"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162061"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162063"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679162060"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162060"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162062"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Typing Bool) -&gt; Bool -&gt; Typing Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162061"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162060"><span class="hs-identifier hs-var">p2</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#TerOp"><span class="hs-identifier hs-type">TerOp</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679162058"><span class="annot"><span class="annottext">e1 :: Expr
</span><a href="#local-6989586621679162058"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621679162057"><span class="annot"><span class="annottext">e2 :: Expr
</span><a href="#local-6989586621679162057"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span id="local-6989586621679162056"><span class="annot"><span class="annottext">e3 :: Expr
</span><a href="#local-6989586621679162056"><span class="hs-identifier hs-var">e3</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679162055"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162055"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162058"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621679162054"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162054"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162057"><span class="hs-identifier hs-var">e2</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621679162053"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162053"><span class="hs-identifier hs-var">p3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Typing Bool
</span><a href="Jikka.Converter.Python.TypeInfer.html#hasLeakedVars"><span class="hs-identifier hs-var">hasLeakedVars</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679162056"><span class="hs-identifier hs-var">e3</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Typing Bool) -&gt; Bool -&gt; Typing Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162055"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162054"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679162053"><span class="hs-identifier hs-var">p3</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Sub"><span class="hs-identifier hs-type">Sub</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- ignore complicated annotations</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ListExt"><span class="hs-identifier hs-type">ListExt</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- ignore complicated annotations</span><span>
</span><span id="line-439"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#ListComp"><span class="hs-identifier hs-type">ListComp</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- ignore complicated annotations</span><span>
</span><span id="line-440"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#IterComp"><span class="hs-identifier hs-type">IterComp</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- ignore complicated annotations</span><span>
</span><span id="line-441"></span><span>  </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Typing Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- ignore complicated annotations</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- typing AST</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="annot"><a href="Jikka.Converter.Python.TypeInfer.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Jikka.Language.Python.Typed.Expr.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span>
</span><span id="line-447"></span><span id="run"><span class="annot"><span class="annottext">run :: Program -&gt; Either String Program
</span><a href="Jikka.Converter.Python.TypeInfer.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621679162052"><span class="annot"><span class="annottext">prog :: Program
</span><a href="#local-6989586621679162052"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Typing Program -&gt; Either String Program
forall a. Typing a -&gt; Either String a
</span><a href="Jikka.Converter.Python.TypeInfer.html#runTyping"><span class="hs-identifier hs-var">runTyping</span></a></span><span> </span><span class="annot"><span class="annottext">(Typing Program -&gt; Either String Program)
-&gt; Typing Program -&gt; Either String Program
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-448"></span><span>  </span><span id="local-6989586621679162051"><span class="annot"><span class="annottext">[ToplevelDecl]
</span><a href="#local-6989586621679162051"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; [ToplevelDecl]
-&gt; ExceptT String (State TypingState) [ToplevelDecl]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ToplevelDecl -&gt; Typing ToplevelDecl
</span><a href="Jikka.Converter.Python.TypeInfer.html#unifyToplevelDecl"><span class="hs-identifier hs-var">unifyToplevelDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Program -&gt; [ToplevelDecl]
</span><a href="Jikka.Language.Python.Typed.Expr.html#decls"><span class="hs-identifier hs-var hs-var">decls</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679162052"><span class="hs-identifier hs-var">prog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621679162049"><span class="annot"><span class="annottext">[ToplevelDecl]
</span><a href="#local-6989586621679162049"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToplevelDecl -&gt; Typing ToplevelDecl)
-&gt; [ToplevelDecl]
-&gt; ExceptT String (State TypingState) [ToplevelDecl]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">ToplevelDecl -&gt; Typing ToplevelDecl
</span><a href="Jikka.Converter.Python.TypeInfer.html#substToplevelDecl"><span class="hs-identifier hs-var">substToplevelDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[ToplevelDecl]
</span><a href="#local-6989586621679162051"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="annottext">Program -&gt; Typing Program
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Program -&gt; Typing Program) -&gt; Program -&gt; Typing Program
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ToplevelDecl] -&gt; Program
</span><a href="Jikka.Language.Python.Typed.Expr.html#Program"><span class="hs-identifier hs-var">Program</span></a></span><span> </span><span class="annot"><span class="annottext">[ToplevelDecl]
</span><a href="#local-6989586621679162049"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-451"></span></pre></body></html>